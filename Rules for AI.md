# Quiz4selection AI 対話ルール

## 1. 基本方針

- 常に日本語で応答すること
- コードの変更は必ず理由を説明すること
- エラーハンドリングを重視すること
- デバッグログを適切に使用すること

## 2. コード修正ルール

### 2.1 変更前の確認

- 既存コードの動作を理解してから修正を提案
- 依存関係への影響を確認
- 変更による副作用を検討

### 2.2 変更時の注意点

- コメントとドキュメント文字列は維持・更新
- import 文の順序は保持
- インデントスタイルは統一
- デバッグログは適切な場所に配置

### 2.3 禁止事項

- 認証情報のハードコーディング
- 未使用の import 文の追加
- 説明のないマジックナンバーの使用
- 既存のエラーハンドリングの削除

## 3. データベース操作

### 3.1 モデル定義

- SQLAlchemy モデルの規約に従う
- 適切なリレーションシップを定義
- バリデーションルールを含める

### 3.2 マイグレーション

- マイグレーションファイルは慎重に作成
- ロールバック手順を考慮
- データ整合性を確保

## 4. テンプレート修正

### 4.1 基本ルール

- base.html からの継承を維持
- 一貫したレイアウトを保持
- 適切なブロック構造を使用

### 4.2 JavaScript 連携

- イベントハンドラの命名規則を統一
- デバッグログを適切に配置
- エラーハンドリングを実装

## 5. クイズデータ

### 5.1 データ構造

- JSON 形式を維持
- 必須フィールドを確保
- 文字エンコーディングは UTF-8

### 5.2 問題フォーマット

```json
{
  "question": "問題文",
  "options": ["選択肢1", "選択肢2", "選択肢3", "選択肢4"],
  "correct": 0,
  "explanation": "解説文"
}
```

## 6. セキュリティ考慮事項

- ユーザー入力の検証
- SQL インジェクション対策
- セッション管理の適切な実装
- CSRF 対策の維持

## 7. パフォーマンス最適化

- 不要なデータベースクエリの削減
- キャッシュの適切な使用
- 静的ファイルの最適化
- セッションデータの最小化

## 8. エラーハンドリング

### 8.1 ログ記録

```python
logger.info("[Debug] 処理開始: {処理名}")
logger.error("[Debug] エラー発生: {エラー内容}")
logger.debug("[Debug] 変数の状態: {変数}")
```

### 8.2 エラーメッセージ

- ユーザーフレンドリーなメッセージ
- デバッグに必要な情報の記録
- スタックトレースの保持

## 9. コードレビュー基準

- 可読性の確保
- パフォーマンスへの影響
- セキュリティリスク
- 保守性の考慮

## 10. デプロイメント考慮事項

- 環境変数の使用
- デバッグモードの無効化
- ログレベルの適切な設定
- エラーハンドリングの完全性
